<!doctype html>
<html lang="sv" data-theme="light">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Kompassen</title>
<style>
:root{
  --bg:#f6f7fb;--card:#ffffff;--line:#e0e4ef;--text:#111318;--muted:#5f6675;--accent:#3b6aff;
  --gold:#d8b55f;--gold-ink:#1b1400;--shadow:0 6px 24px rgba(10,20,40,.08);
  --match:#fff6d6
}
html[data-theme=dark]{
  --bg:#0f1115;--card:#141820;--line:#242b3a;--text:#e9edf5;--muted:#9aa3b2;--accent:#7aa2ff;
  --gold:#caa24e;--gold-ink:#0d0b00;--shadow:0 8px 28px rgba(0,0,0,.35);
  --match:#2d2615
}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--text);font:14px/1.45 system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
header{
  position:sticky;top:0;z-index:10;backdrop-filter:saturate(1.05) blur(6px);
  background:color-mix(in oklab, var(--bg) 90%, transparent);
  border-bottom:1px solid var(--line);padding:12px 16px;display:flex;gap:12px;align-items:center;justify-content:space-between
}
h1{margin:0;font-size:18px;font-weight:800}
.right{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.btn{border:1px solid var(--line);background:var(--card);color:inherit;border-radius:12px;padding:8px 12px;cursor:pointer;font-weight:700;box-shadow:var(--shadow)}
.btn.ghost{background:transparent}
.searchbar{display:flex;align-items:center;gap:8px;background:var(--card);border:1px solid var(--line);border-radius:12px;padding:8px 12px;box-shadow:var(--shadow)}
.searchbar input{all:unset;width:260px}

main{max-width:1200px;margin:18px auto;padding:0 16px;display:flex;flex-direction:column;gap:16px}
.card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:14px;box-shadow:var(--shadow)}

/* Summary & selection */
#selectionSummary{text-align:center;padding:16px}
#selectionSummary h2{margin:0 0 10px 0;font-size:17px}
.selection-list{display:flex;flex-wrap:wrap;gap:8px;justify-content:center}
.selection-list .item{
  background:var(--match);padding:6px 10px;border-radius:8px;
  font-weight:600;border:1px solid var(--line);min-width:120px;text-align:center;
}

/* Summary top */
.summary-top{text-align:center;padding:18px 14px}
.summary-top h2{margin:0 0 6px 0}
.summary-grid{display:flex;flex-wrap:wrap;justify-content:center;gap:16px}
.summary-grid .box{min-width:180px;padding:8px 6px;line-height:1.3}
.summary-grid .box div:first-child{font-size:13px;color:var(--muted)}
.summary-grid .val{font-size:20px;font-weight:800;margin-top:2px}
.bump{animation:bump .35s ease}@keyframes bump{0%{transform:translateY(-1px)}50%{transform:translateY(1px)}100%{transform:translateY(0)}}

/* Layout */
.layout{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(380px,1fr))}
details.widget{border:1px solid var(--line);border-radius:14px;overflow:hidden}
details.widget>summary{
  list-style:none;padding:8px 10px;display:flex;align-items:center;justify-content:space-between;cursor:pointer;font-weight:800
}
details.widget>summary::-webkit-details-marker{display:none}
.widget-body{border-top:1px dashed var(--line);padding:8px 8px 10px}

/* Plan rows */
.plan{
  display:grid;grid-template-columns:auto 70px 70px 70px auto;
  align-items:center;gap:8px;
  border:1px solid var(--line);border-radius:10px;padding:8px;margin:6px 0;
  transition:background .15s ease,border-color .15s ease,box-shadow .15s ease
}
.plan:hover{background:color-mix(in oklab, var(--card) 80%, var(--match))}
.plan.selected{border-color:var(--gold);box-shadow:0 0 0 2px color-mix(in oklab, var(--gold) 28%, transparent)}
.plan .left{display:flex;align-items:center;gap:8px}
.plan .info{
  width:18px;height:18px;border-radius:999px;border:1px solid var(--line);
  display:inline-flex;align-items:center;justify-content:center;
  font-size:11px;color:var(--muted);cursor:pointer
}
.input-wrap{display:flex;flex-direction:column;gap:2px}
.input-wrap small{opacity:.7;font-size:10px}
.input-wrap input[type=number]{
  width:100%;background:var(--card);border:1px solid var(--line);color:var(--text);
  border-radius:8px;padding:6px 6px;text-align:right;font-weight:600;
  transition:background .12s ease,border-color .12s ease,box-shadow .12s ease
}
.input-wrap input.active{
  background:var(--gold);color:var(--gold-ink);
  box-shadow:0 0 0 2px color-mix(in oklab, var(--gold) 40%, transparent) inset;
  border-color:color-mix(in oklab, var(--gold) 60%, var(--line))
}

/* Netflix toggle */
.nf-toggle{display:flex;align-items:center;gap:6px;justify-self:end}
.nf-toggle input{accent-color:var(--accent);transform:scale(1.1)}
.nf-icon{
  font-size:12px;font-weight:800;color:var(--accent);
  border:1px solid var(--line);border-radius:999px;
  width:18px;height:18px;display:inline-flex;align-items:center;justify-content:center;
}
.nf-icon:hover::after{
  content:"Netflix +100 kr/m√•n";position:absolute;transform:translateY(24px);
  background:var(--card);color:var(--text);font-size:11px;
  border:1px solid var(--line);padding:2px 6px;border-radius:6px;white-space:nowrap;
  box-shadow:var(--shadow)
}
.badge{font-size:11px;padding:2px 8px;border-radius:999px;border:1px solid var(--line);color:var(--muted)}
.match{background:var(--match)}
</style>
</head>
<body>
<header>
  <h1>Kompassen</h1>
  <div class="right">
    <div class="searchbar" title="S√∂k p√• paket, kanaler eller sport: Mini, Mellan, Mycket, Premier League, SHL, TV4, Viaplay, Max ‚Ä¶">
      üîé <input id="search" placeholder="S√∂k paket, kanaler eller sport ‚Ä¶">
      <button id="clearSearch" class="btn ghost">Rensa</button>
    </div>
    <button id="themeBtn" class="btn">M√∂rkt l√§ge</button>
    <button id="resetBtn" class="btn ghost">√Öterst√§ll</button>
  </div>
</header>

<main>
  <!-- Dina val -->
  <section id="selectionSummary" class="card">
    <h2>Dina valda paket</h2>
    <div class="selection-list" id="selectedList">
      <div class="item muted">Inga val √§nnu</div>
    </div>
  </section>

  <!-- Summering -->
  <section id="calcSummary" class="card summary-top">
    <h2>Samlad kalkyl</h2>
    <div class="summary-grid">
      <div class="box"><div>F√∂rsta 6 m√•n</div><div id="s1" class="val">0 SEK</div></div>
      <div class="box"><div>Andra 6 m√•n</div><div id="s2" class="val">0 SEK</div></div>
      <div class="box"><div>Hel√•r totalt</div><div id="year" class="val">0 SEK</div></div>
      <div class="box"><div>Snitt / m√•n</div><div id="avg" class="val">0 SEK</div></div>
    </div>
  </section>

  <section class="layout" id="widgets"></section>
</main>

<script>
const GROUPS=[
  {cat:"Bredband",plans:[
    {id:"bb100",label:"Bredband 100/100 Mbit/s",tip:"Passar 1‚Äì2 personer",tags:"bredband 100"},
    {id:"bb300",label:"Bredband 300/300 Mbit/s",tip:"F√∂r familjer med flera enheter",tags:"bredband 300 familj"},
    {id:"bb1000",label:"Bredband 1000/1000 Mbit/s",tip:"Maxprestanda, spel & 4K/8K media",tags:"bredband 1000 spel"}
  ]},
  {cat:"TV grundpaket",plans:[
    {id:"tvMini",label:"TV Mini",tip:"Basutbud ~19 kanaler + TV4 Play",tags:"tv mini tv4"},
    {id:"tvMellan",label:"TV Mellan",tip:"~36 kanaler + BritBox, familjefavoriter",tags:"tv mellan britbox"},
    {id:"tvMycket",label:"TV Mycket",tip:"~48 kanaler inkl. Viaplay + Max Basic",tags:"tv mycket viaplay max"}
  ]},
  {cat:"Premium",plans:[
    {id:"mer",label:"MER",tip:"Netflix, Max Basic, Disney+",tags:"mer netflix disney",style:"text-align:center;font-weight:800"},
    {id:"maxad",label:"MAXAD",tip:"Netflix + Disney+ + Prime + Max",tags:"maxad netflix prime",style:"text-align:center;font-weight:800"},
    {id:"mest",label:"MEST",tip:"St√∂rst mix inkl. Viaplay & TV4 Play",tags:"mest viaplay tv4",style:"text-align:center;font-weight:800"}
  ]},
  {cat:"Sportpaket",plans:[
    {id:"sportSmall",label:"Lilla Sport",tip:"Allsvenskan, LaLiga, ATP",tags:"sport lilla",sport:true},
    {id:"sportLarge",label:"Stora Sport",tip:"Champions League, Premier League, F1",tags:"sport stora champions premier",sport:true},
    {id:"sportLargest",label:"St√∂rsta Sport",tip:"SHL, golf, F1, allt samlat",tags:"sport storsta shl golf",sport:true}
  ]}
];
const NETFLIX_DELTA=100;
let state={selections:{},prices:{},sportNF:{}};
const fmt=v=>`${(v||0).toFixed(0)} SEK`;
const $=(s,r=document)=>r.querySelector(s);
const $$=(s,r=document)=>[...r.querySelectorAll(s)];

function planRowHTML(cat,plan){
  const pid=plan.id,m6a=state.prices[pid]?.m6a??'',m6b=state.prices[pid]?.m6b??'',m12=state.prices[pid]?.m12??'';
  const checked=state.selections[cat]===pid?'checked':'';
  const nf=plan.sport?`
  <label class="nf-toggle" title="Netflix +100 kr/m√•n">
    <input type="checkbox" class="nf" ${state.sportNF[pid]?'checked':''}>
    <div class="nf-icon">N</div>
  </label>`:`<span></span>`;
  return `
  <div class="plan" data-cat="${cat}" data-id="${pid}" data-tags="${(plan.tags||'').toLowerCase()}">
    <div class="left" style="${plan.style||''}">
      <label><input type="radio" name="${cat}" value="${pid}" ${checked}> ${plan.label}</label>
      <span class="info" title="${plan.tip||''}">i</span>
    </div>
    <div class="input-wrap"><input type="number" class="m6a" value="${m6a}" placeholder="0"><small>6 m√•n (1)</small></div>
    <div class="input-wrap"><input type="number" class="m6b" value="${m6b}" placeholder="0"><small>6 m√•n (2)</small></div>
    <div class="input-wrap"><input type="number" class="m12" value="${m12}" placeholder="0"><small>12 m√•n</small></div>
    ${nf}
  </div>`;}
  
function buildUI(){
  const grid=$('#widgets');grid.innerHTML='';
  GROUPS.forEach(g=>{
    const d=document.createElement('details');d.className='widget';d.open=true;
    d.innerHTML=`<summary><span>${g.cat}</span><span class="badge">V√§lj ett alternativ</span></summary>
      <div class="widget-body">${g.plans.map(p=>planRowHTML(g.cat,p)).join('')}</div>`;
    grid.appendChild(d);
  });
  attachEvents();updateTotals(false);
}

function attachEvents(){
  $$('input[type=radio]').forEach(r=>{
    r.addEventListener('change',()=>{const row=r.closest('.plan');state.selections[row.dataset.cat]=r.value;updateTotals(true);});
  });
  $$('.m6a,.m6b,.m12').forEach(inp=>{
    inp.addEventListener('input',()=>{const row=inp.closest('.plan'),pid=row.dataset.id;
      const a=+($('.m6a',row).value)||0,b=+($('.m6b',row).value)||0,c=+($('.m12',row).value)||0;
      state.prices[pid]={m6a:a||null,m6b:b||null,m12:c||null};updateTotals(true);});
  });
  $$('.nf').forEach(ch=>{ch.addEventListener('change',()=>{state.sportNF[ch.closest('.plan').dataset.id]=ch.checked;updateTotals(true);});});
  const s=$('#search'),c=$('#clearSearch');
  s.addEventListener('input',()=>{const q=s.value.trim().toLowerCase();
    $$('.plan').forEach(r=>{const hay=(r.textContent||'').toLowerCase()+(r.dataset.tags||'');r.style.display=!q||hay.includes(q)?'grid':'none';});});
  c.addEventListener('click',()=>{s.value='';s.dispatchEvent(new Event('input'));});
  $('#resetBtn').addEventListener('click',()=>{state={selections:{},prices:{},sportNF:{}};buildUI();});
  $('#themeBtn').addEventListener('click',()=>{const root=document.documentElement;const dark=root.getAttribute('data-theme')==='dark';
    root.setAttribute('data-theme',dark?'light':'dark');$('#themeBtn').textContent=dark?'M√∂rkt l√§ge':'Ljust l√§ge';});
}

function updateTotals(anim){
  let s6a=0,s6b=0;let selected=[];
  GROUPS.forEach(g=>{
    const pid=state.selections[g.cat];if(!pid)return;
    const plan=g.plans.find(p=>p.id===pid);selected.push(plan.label);
    const p=state.prices[pid]||{};const a=+p.m6a||0,b=+p.m6b||0,c=+p.m12||0;
    let nf=0;if(g.cat==="Sportpaket"&&state.sportNF[pid])nf=NETFLIX_DELTA;
    if(c>0){s6a+=(c+nf)*12;}else{s6a+=(a+nf)*6;s6b+=(b+nf)*6;}
  });
  const year=s6a+s6b,avg=year/12;
  $('#s1').textContent=fmt(s6a);$('#s2').textContent=fmt(s6b);
  $('#year').textContent=fmt(year);$('#avg').textContent=fmt(avg);
  const list=$('#selectedList');list.innerHTML=selected.length?selected.map(s=>`<div class="item">${s}</div>`).join(''):'<div class="item muted">Inga val √§nnu</div>';
}
buildUI();
</script>
</body>
</html>
