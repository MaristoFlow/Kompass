<!doctype html>
<html lang="sv" data-theme="light">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Kompassen – Kostnadskalkylator</title>
<style>
:root{
  --bg:#f3f5fa;--card:#fff;--line:#dce0ea;--text:#111;--muted:#666;
  --accent:#4169e1;--accent-glow:#7f9cff;--gold:#dcb44e;
  --shadow:0 5px 20px rgba(0,0,0,.08)
}
html[data-theme=dark]{
  --bg:#0d0f13;--card:#151923;--line:#2c3342;--text:#e9ecf2;--muted:#9aa3b2;
  --accent:#7aa2ff;--accent-glow:#b6c8ff;--gold:#cfa748;
  --shadow:0 6px 24px rgba(0,0,0,.45)
}
body{
  margin:0;background:var(--bg);color:var(--text);
  font:15px/1.6 'Inter',system-ui,Segoe UI,Roboto,sans-serif;
  transition:background .3s,color .3s
}
main{max-width:1200px;margin:40px auto;padding:0 20px;display:flex;flex-direction:column;gap:28px}
h1{text-align:center;font-size:26px;font-weight:800;margin:0 0 10px;letter-spacing:.3px}
.card{
  background:var(--card);border:1px solid var(--line);border-radius:16px;
  box-shadow:var(--shadow);padding:20px;transition:background .3s,border .3s
}
button{border:none;background:var(--accent);color:#fff;border-radius:10px;
  padding:9px 16px;cursor:pointer;font-weight:700;font-size:14px;
  transition:all .25s ease;box-shadow:0 0 8px var(--accent-glow)
}
button:hover{background:var(--gold);color:#111;box-shadow:0 0 12px var(--gold)}
.topbar{display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap}
.toggle{background:var(--card);border:1px solid var(--line);color:var(--text);font-weight:800;cursor:pointer;border-radius:8px;padding:6px 14px}

.summary{display:flex;flex-wrap:wrap;justify-content:center;gap:24px;text-align:center}
.summary .box{min-width:180px}
.summary .box div:first-child{font-size:13px;color:var(--muted)}
.summary .val{font-size:20px;font-weight:800;margin-top:3px}

.grid{display:grid;gap:14px;grid-template-columns:repeat(auto-fit,minmax(520px,1fr))}
.category{border:1px solid var(--line);border-radius:14px;padding:16px;background:var(--card);transition:background .3s,border .3s}
.category h2{margin:0 0 12px;font-size:17px;border-bottom:1px dashed var(--line);padding-bottom:6px;text-align:center;font-weight:700;letter-spacing:.2px}
.option{display:flex;align-items:center;justify-content:space-between;
  border:1px solid var(--line);border-radius:12px;padding:8px 10px;margin-bottom:8px;
  background:var(--card);transition:all .2s}
.option:hover{background:rgba(64,105,225,.05)}
.option.active{border-color:var(--accent);box-shadow:0 0 0 2px var(--accent-glow)}
.option-label{flex:1;font-weight:600}
.controls{display:flex;align-items:center;gap:6px;flex-wrap:wrap;justify-content:flex-end}
.controls input{width:60px;padding:5px;border:1px solid var(--line);border-radius:8px;text-align:right;font-weight:600;background:var(--card);color:var(--text)}
.controls small{font-size:10px;color:var(--muted);display:block;text-align:center}
.controls .col{display:flex;flex-direction:column;align-items:center}

.results-card{display:flex;flex-direction:column;gap:10px}
.result-item{display:flex;justify-content:space-between;border-bottom:1px dashed var(--line);padding:4px 0;font-weight:600}
.result-item span:last-child{font-weight:800}
.cat-avg{display:flex;flex-wrap:wrap;justify-content:center;gap:20px;text-align:center;margin-top:10px}
.cat-avg .cbox{min-width:150px;background:var(--card);border:1px solid var(--line);
  border-radius:10px;padding:10px 12px;box-shadow:var(--shadow)}
.cat-avg .cbox div:first-child{font-size:13px;color:var(--muted)}
.cat-avg .val{font-weight:700;margin-top:3px}
</style>
</head>
<body>
<main>
  <div class="topbar">
    <h1>Kompassen – Kostnadskalkylator</h1>
    <button id="themeToggle" class="toggle">DARK</button>
  </div>

  <section id="calcSummary" class="card">
    <div class="summary">
      <div class="box"><div>Helår totalt</div><div id="year" class="val">0 SEK</div></div>
      <div class="box"><div>Snitt / månad</div><div id="avg" class="val">0 SEK</div></div>
      <div class="box"><div>Antal val</div><div id="count" class="val">0</div></div>
    </div>
    <div id="categoryAverages" class="cat-avg"></div>
  </section>

  <section class="grid" id="grid"></section>

  <section id="results" class="card results-card">
    <h2>Valda val</h2>
    <div id="resultList"><div class="result-item"><span>Inga val ännu</span></div></div>
  </section>
</main>

<script>
const CATEGORIES = {
  "Bredband": ["Bredband 1", "Bredband 2"],
  "TV": ["Film 1", "Film 2"],
  "Sport": ["Sport 1", "Sport 2"],
  "Mobil": ["Abonnemang 1", "Abonnemang 2"],
  "Övrigt": ["Mobiltelefon", "Försäkring"]
};
const PERIODS = ["6m A","6m B","18m","24m"];
const $=(s,r=document)=>r.querySelector(s);
const $$=(s,r=document)=>[...r.querySelectorAll(s)];
const fmt=v=>`${v.toFixed(0)} SEK`;

function createCategory(name,options){
  return `<div class="category" data-cat="${name}">
    <h2>${name}</h2>
    ${options.map(o=>`
      <div class="option" data-option="${o}">
        <div class="option-label">${o}</div>
        <div class="controls">
          ${PERIODS.map(p=>`
            <div class="col">
              <input type="number" placeholder="0" data-period="${p}">
              <small>${p}</small>
            </div>`).join('')}
        </div>
      </div>`).join('')}
  </div>`;
}

function buildUI(){
  $('#grid').innerHTML=Object.entries(CATEGORIES)
    .map(([cat,opts])=>createCategory(cat,opts)).join('');
  $$('.option').forEach(opt=>{
    opt.addEventListener('click',e=>{
      if(e.target.tagName!=='INPUT'){
        opt.classList.toggle('active');
        updateResults();
      }
    });
    $$('input',opt).forEach(inp=>inp.addEventListener('input',updateResults));
  });
  $('#themeToggle').addEventListener('click',toggleTheme);
}

function updateResults(){
  const active=$$('.option.active');
  const list=$('#resultList');
  const catAvgBox=$('#categoryAverages');
  if(!active.length){
    list.innerHTML='<div class="result-item"><span>Inga val ännu</span></div>';
    catAvgBox.innerHTML='';
    $('#year').textContent='0 SEK';$('#avg').textContent='0 SEK';$('#count').textContent='0';
    return;
  }

  const grouped={}; let totalMonth=0,count=0;
  active.forEach(el=>{
    const cat=el.closest('.category').dataset.cat;
    const label=el.dataset.option;
    const inputs=$$('input',el);
    const vals=inputs.map(i=>+i.value||0);
    const avg=vals.reduce((a,b)=>a+b,0)/vals.length;
    if(!grouped[cat]) grouped[cat]=[];
    grouped[cat].push({label,avg});
    totalMonth+=avg; count++;
  });

  // --- Resultlista ---
  list.innerHTML='';
  Object.entries(grouped).forEach(([cat,opts])=>{
    const text=opts.map(o=>`${o.label} (${fmt(o.avg)})`).join(', ');
    list.innerHTML+=`<div class="result-item"><span>${cat}</span><span>${text}</span></div>`;
  });

  // --- Totals ---
  $('#avg').textContent=fmt(totalMonth);
  $('#year').textContent=fmt(totalMonth*12);
  $('#count').textContent=count;

  // --- Snitt per kategori ---
  catAvgBox.innerHTML='';
  Object.entries(grouped).forEach(([cat,opts])=>{
    const catAvg=opts.reduce((a,b)=>a+b.avg,0)/opts.length;
    catAvgBox.innerHTML+=`<div class="cbox"><div>${cat}</div><div class="val">${fmt(catAvg)}</div></div>`;
  });
}

function toggleTheme(){
  const root=document.documentElement;
  const dark=root.getAttribute('data-theme')==='dark';
  root.setAttribute('data-theme',dark?'light':'dark');
  $('#themeToggle').textContent=dark?'DARK':'LIGHT';
}

buildUI();
</script>
</body>
</html>
