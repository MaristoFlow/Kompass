<!doctype html>
<html lang="sv" data-theme="light">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Kompassen</title>
<style>
:root{
  --bg:#f6f7fb;--card:#ffffff;--line:#e0e4ef;--text:#111318;--muted:#5f6675;--accent:#3b6aff;
  --gold:#d8b55f;--gold-ink:#1b1400;--shadow:0 6px 24px rgba(10,20,40,.08);
  --match:#fff6d6
}
html[data-theme=dark]{
  --bg:#0f1115;--card:#141820;--line:#242b3a;--text:#e9edf5;--muted:#9aa3b2;--accent:#7aa2ff;
  --gold:#caa24e;--gold-ink:#0d0b00;--shadow:0 8px 28px rgba(0,0,0,.35);
  --match:#2d2615
}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--text);font:14px/1.45 system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
header{position:sticky;top:0;z-index:10;backdrop-filter:saturate(1.05) blur(6px);
  background:color-mix(in oklab, var(--bg) 90%, transparent);border-bottom:1px solid var(--line);
  padding:12px 16px;display:flex;gap:12px;align-items:center;justify-content:space-between}
h1{margin:0;font-size:18px;font-weight:800}
.right{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.btn{border:1px solid var(--line);background:var(--card);color:inherit;border-radius:12px;padding:8px 12px;cursor:pointer;font-weight:700;box-shadow:var(--shadow)}
.btn.ghost{background:transparent}
.searchbar{display:flex;align-items:center;gap:8px;background:var(--card);border:1px solid var(--line);border-radius:12px;padding:8px 12px;box-shadow:var(--shadow)}
.searchbar input{all:unset;width:260px}

main{max-width:1300px;margin:18px auto;padding:0 16px;display:flex;flex-direction:column;gap:16px}
.card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:14px;box-shadow:var(--shadow)}

#selectionSummary{text-align:center;padding:16px}
.selection-list{display:flex;flex-wrap:wrap;gap:8px;justify-content:center}
.selection-list .item{background:var(--match);padding:6px 10px;border-radius:8px;font-weight:600;border:1px solid var(--line);min-width:150px;text-align:center}

.summary-top{text-align:center;padding:18px 14px}
.summary-grid{display:flex;flex-wrap:wrap;justify-content:center;gap:16px}
.summary-grid .box{min-width:180px;padding:8px 6px;line-height:1.3}
.summary-grid .box div:first-child{font-size:13px;color:var(--muted)}
.summary-grid .val{font-size:20px;font-weight:800;margin-top:2px}

.layout{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(380px,1fr))}
details.widget{border:1px solid var(--line);border-radius:14px;overflow:hidden;transition:all .2s ease}
details.widget>summary{
  list-style:none;padding:8px 10px;display:flex;align-items:center;justify-content:space-between;cursor:pointer;font-weight:800
}
details.widget>summary::-webkit-details-marker{display:none}
summary .icon{transition:transform .2s ease}
details[open] summary .icon{transform:rotate(180deg)}
.widget-body{border-top:1px dashed var(--line);padding:8px 8px 10px}

.plan{display:grid;grid-template-columns:auto 70px 70px 70px auto;align-items:center;gap:8px;
  border:1px solid var(--line);border-radius:10px;padding:8px;margin:6px 0;
  transition:background .15s ease,border-color .15s ease,box-shadow .15s ease}
.plan.mobile{grid-template-columns:auto 90px auto;}
.plan:hover{background:color-mix(in oklab, var(--card) 80%, var(--match))}
.plan.selected{border-color:var(--gold);box-shadow:0 0 0 2px color-mix(in oklab, var(--gold) 28%, transparent)}
.input-wrap{display:flex;flex-direction:column;gap:2px}
.input-wrap small{opacity:.7;font-size:10px}
.input-wrap input[type=number]{width:100%;background:var(--card);border:1px solid var(--line);
  color:var(--text);border-radius:8px;padding:6px;text-align:right;font-weight:600}

.nf-toggle{display:flex;align-items:center;gap:6px;justify-self:end}
.nf-icon{font-size:12px;font-weight:800;color:var(--accent);border:1px solid var(--line);border-radius:999px;width:18px;height:18px;display:inline-flex;align-items:center;justify-content:center}
</style>
</head>
<body>
<header>
  <h1>Kompassen</h1>
  <div class="right">
    <div class="searchbar"><span>üîé</span><input id="search" placeholder="S√∂k paket ‚Ä¶"><button id="clearSearch" class="btn ghost">Rensa</button></div>
    <button id="themeBtn" class="btn">M√∂rkt l√§ge</button>
    <button id="resetBtn" class="btn ghost">√Öterst√§ll</button>
  </div>
</header>

<main>
  <section id="selectionSummary" class="card">
    <h2>Dina valda paket</h2>
    <div class="selection-list" id="selectedList"><div class="item muted">Inga val √§nnu</div></div>
  </section>

  <section id="calcSummary" class="card summary-top">
    <h2>Samlad kalkyl</h2>
    <div class="summary-grid">
      <div class="box"><div>F√∂rsta 6 m√•n (pris/m√•n)</div><div id="s1" class="val">0 SEK</div></div>
      <div class="box"><div>Andra 6 m√•n (pris/m√•n)</div><div id="s2" class="val">0 SEK</div></div>
      <div class="box"><div>Hel√•r totalt</div><div id="year" class="val">0 SEK</div></div>
      <div class="box"><div>Snitt / m√•n</div><div id="avg" class="val">0 SEK</div></div>
    </div>
  </section>

  <section class="layout" id="widgets"></section>
</main>

<script>
const GROUPS=[
  {cat:"Bredband",plans:[{id:"bb1",label:"Bredband 1"},{id:"bb2",label:"Bredband 2"},{id:"bb3",label:"Bredband 3"}]},
  {cat:"TV-paket",plans:[{id:"mini",label:"Mini"},{id:"mellan",label:"Mellan"},{id:"mycket",label:"Mycket"}]},
  {cat:"Premiumpaket",plans:[{id:"mer",label:"Mer"},{id:"maxad",label:"Maxad"},{id:"mest",label:"Mest"}]},
  {cat:"Sportpaket",plans:[{id:"sportSmall",label:"Lilla S",sport:true},{id:"sportLarge",label:"Stora S",sport:true},{id:"sportLargest",label:"St√∂rsta S",sport:true}]},
  {cat:"Mobilabonnemang",plans:[{id:"mob1",label:"Mobil 1"},{id:"mob2",label:"Mobil 2"},{id:"mob3",label:"Mobil 3"}]},
  {cat:"√ñvrigt",plans:[{id:"mobil24",label:"Mobil Telefon (24 m√•n)",type:"mobile"},{id:"forsakring",label:"F√∂rs√§kring"},{id:"egen",label:"Eget val (fyll i sj√§lv)"}]}
];
const NETFLIX_DELTA=100;
let state={selections:{},prices:{},sportNF:{}};
const fmt=v=>`${(v||0).toFixed(0)} SEK`;
const $=(s,r=document)=>r.querySelector(s);
const $$=(s,r=document)=>[...r.querySelectorAll(s)];

function planRowHTML(cat,plan){
  const pid=plan.id;
  const checked=state.selections[cat]===pid?'checked':'';
  const price=state.prices[pid]?.m24??'';
  const nf=plan.sport?`<label class="nf-toggle"><input type="checkbox" class="nf" ${state.sportNF[pid]?'checked':''}><div class="nf-icon">N</div></label>`:`<span></span>`;
  if(plan.type==="mobile"){
    return `<div class="plan mobile" data-cat="${cat}" data-id="${pid}">
      <label><input type="radio" name="${cat}" value="${pid}" ${checked}> ${plan.label}</label>
      <div class="input-wrap"><input type="number" class="m24" value="${price}" placeholder="0"><small>24 m√•n</small></div>
    </div>`;
  }
  const m6a=state.prices[pid]?.m6a??'',m6b=state.prices[pid]?.m6b??'',m12=state.prices[pid]?.m12??'';
  return `<div class="plan" data-cat="${cat}" data-id="${pid}">
    <label><input type="radio" name="${cat}" value="${pid}" ${checked}> ${plan.label}</label>
    <div class="input-wrap"><input type="number" class="m6a" value="${m6a}" placeholder="0"><small>6 m√•n (1) / m√•n</small></div>
    <div class="input-wrap"><input type="number" class="m6b" value="${m6b}" placeholder="0"><small>6 m√•n (2) / m√•n</small></div>
    <div class="input-wrap"><input type="number" class="m12" value="${m12}" placeholder="0"><small>12 m√•n / m√•n</small></div>
    ${nf}
  </div>`;
}

function buildUI(){
  const grid=$('#widgets');grid.innerHTML='';
  GROUPS.forEach(g=>{
    const d=document.createElement('details');d.className='widget';d.open=true;
    d.innerHTML=`<summary><span>${g.cat}</span><span class="icon">‚ñº</span></summary>
      <div class="widget-body">${g.plans.map(p=>planRowHTML(g.cat,p)).join('')}</div>`;
    grid.appendChild(d);
  });
  attachEvents();updateTotals();
}

function attachEvents(){
  $$('input[type=radio]').forEach(r=>{
    r.addEventListener('click',()=>{
      const cat=r.closest('.plan').dataset.cat;
      if(state.selections[cat]===r.value){r.checked=false;delete state.selections[cat];}
      else state.selections[cat]=r.value;
      updateTotals();
    });
  });
  $$('input[type=number]').forEach(inp=>inp.addEventListener('input',()=>{
    const row=inp.closest('.plan'),pid=row.dataset.id;
    const a=+($('.m6a',row)?.value)||0,b=+($('.m6b',row)?.value)||0,c=+($('.m12',row)?.value)||0,d=+($('.m24',row)?.value)||0;
    state.prices[pid]={m6a:a||null,m6b:b||null,m12:c||null,m24:d||null};updateTotals();
  }));
  $$('.nf').forEach(ch=>ch.addEventListener('change',()=>{
    state.sportNF[ch.closest('.plan').dataset.id]=ch.checked;updateTotals();
  }));
  $('#themeBtn').addEventListener('click',()=>{
    const root=document.documentElement;const dark=root.getAttribute('data-theme')==='dark';
    root.setAttribute('data-theme',dark?'light':'dark');$('#themeBtn').textContent=dark?'M√∂rkt l√§ge':'Ljust l√§ge';
  });
  $('#resetBtn').addEventListener('click',()=>{state={selections:{},prices:{},sportNF:{}};buildUI();});
}

function updateTotals(){
  let total6a=0,total6b=0;const selected=[];
  GROUPS.forEach(g=>{
    const pid=state.selections[g.cat];if(!pid)return;
    const p=state.prices[pid]||{};const a=+p.m6a||0,b=+p.m6b||0,c=+p.m12||0,d=+p.m24||0;
    let nf=0;if(g.cat==="Sportpaket"&&state.sportNF[pid])nf=NETFLIX_DELTA;
    selected.push(`${g.cat}: ${pid} ‚Äì ${fmt(a||b||c||d)}`);
    total6a+=a+nf; total6b+=b+nf;
  });
  const year=(total6a+total6b)*6,avg=(total6a+total6b)/2;
  $('#s1').textContent=fmt(total6a);
  $('#s2').textContent=fmt(total6b);
  $('#year').textContent=fmt(year);
  $('#avg').textContent=fmt(avg);
  $('#selectedList').innerHTML=selected.length?selected.map(s=>`<div class="item">${s}</div>`).join(''):'<div class="item muted">Inga val √§nnu</div>';
}
buildUI();
</script>
</body>
</html>
